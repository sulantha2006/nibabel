<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Neuroimaging in Python &#8212; NiBabel 2.1.1dev documentation</title>
    
    <link rel="stylesheet" href="../_static/nibabel.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.1.1dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="NiBabel 2.1.1dev documentation" href="../index.html" />
    <link rel="up" title="Developer documentation page" href="index.html" />
    <link rel="next" title="How to add a new image format to nibabel" href="add_image_format.html" />
    <link rel="prev" title="git resources" href="../gitwash/git_resources.html" />
  <meta name="keywords" content="nipy, neuroimaging, python, neuroscience">

  </head>
  <body role="document">
<div style="background-color: white; text-align: left; padding-left: 150px; padding-bottom:50px; padding-top:20px; background-image: url(../_static/nipy-logo-bg-138x120.png); background-repeat: no-repeat;">
<h1>NiBabel</h1>
<h3 style="margin-top:-5px;color:#2f83c8">Access a cacophony of neuro-imaging file formats</h3>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="add_image_format.html" title="How to add a new image format to nibabel"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../gitwash/git_resources.html" title="git resources"
             accesskey="P">previous</a> |</li>
  <li><a href="http://nipy.org/">Community</a> |&nbsp;</li>
  <li><a href="../index.html">NiBabel Home</a> |&nbsp;</li>
  <li><a href="https://mail.python.org/mailman/listinfo/neuroimaging">Mailing list</a> |&nbsp;</li>
  <li><a href="legal.html">License</a> |&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Developer documentation page</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Adding test data</a><ul>
<li><a class="reference internal" href="#small-files">Small files</a></li>
<li><a class="reference internal" href="#files-with-open-licenses">Files with open licenses</a></li>
<li><a class="reference internal" href="#adding-the-file-to-nibabel-tests-data">Adding the file to <code class="docutils literal"><span class="pre">nibabel/tests/data</span></code></a></li>
<li><a class="reference internal" href="#adding-as-a-submodule-to-nibabel-data">Adding as a submodule to <code class="docutils literal"><span class="pre">nibabel-data</span></code></a><ul>
<li><a class="reference internal" href="#using-submodules-for-tests">Using submodules for tests</a></li>
<li><a class="reference internal" href="#how-much-data-should-go-in-a-single-submodule">How much data should go in a single submodule?</a></li>
<li><a class="reference internal" href="#if-in-doubt">If in doubt</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../gitwash/git_resources.html"
                        title="previous chapter">git resources</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="add_image_format.html"
                        title="next chapter">How to add a new image format to nibabel</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/devel/add_test_data.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<p><img src="../_static/reggie.png" alt="Reggie -- the one" /></p>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="adding-test-data">
<h1>Adding test data<a class="headerlink" href="#adding-test-data" title="Permalink to this headline">¶</a></h1>
<ol class="arabic simple">
<li>We really, really like test images, but</li>
<li>We are rather conservative about the size of our code repository.</li>
</ol>
<p>So, we have two different ways of adding test data.</p>
<ol class="arabic simple">
<li>Small, open licensed files can go in the <code class="docutils literal"><span class="pre">nibabel/tests/data</span></code> directory
(see below);</li>
<li>Larger files or files with extra licensing terms can go in their own git
repositories and be added as submodules to the <code class="docutils literal"><span class="pre">nibabel-data</span></code> directory.</li>
</ol>
<div class="section" id="small-files">
<h2>Small files<a class="headerlink" href="#small-files" title="Permalink to this headline">¶</a></h2>
<p>Small files are around 50K or less when compressed.  By &#8220;compressed&#8221;, we mean,
compressed with zlib, which is what git uses when storing the file in the
repository.  You can check the exact length directly with Python and a script
like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">zlib</span>

<span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">fobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">compressed</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">compressed</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1024.</span><span class="p">)</span>
</pre></div>
</div>
<p>One way of making files smaller when compressed is to set uninteresting values
to zero or some other number so that the compression algorithm can be more
effective.</p>
<p>Please don&#8217;t compress the file yourself before committing to a git repo unless
there&#8217;s a really good reason; git will do this for you when adding to the
repository, and it&#8217;s a shame to make git compress a compressed file.</p>
</div>
<div class="section" id="files-with-open-licenses">
<h2>Files with open licenses<a class="headerlink" href="#files-with-open-licenses" title="Permalink to this headline">¶</a></h2>
<p>We very much prefer files with completely open licenses such as the <a class="reference external" href="http://opendatacommons.org/licenses/pddl/1.0/">PDDL
1.0</a> or the <a class="reference external" href="http://opendefinition.org/licenses/cc-zero">CC0</a> license.</p>
<p>The files in the <code class="docutils literal"><span class="pre">nibabel/tests/data</span></code> will get distributed with the nibabel
source code, and this can easily get installed without the user having an
opportunity to review the full license.  We don&#8217;t think this is compatible
with extra license terms like agreeing to cite the people who provided the
data or agreeing not to try and work out the identity of the person who has
been scanned, because it would be too easy to miss these requirements when
using nibabel.  It is fine to use files with these kind of licenses, but they
should go in their own repository to be used as a submodule, so they do not
need to be distributed with nibabel.</p>
</div>
<div class="section" id="adding-the-file-to-nibabel-tests-data">
<h2>Adding the file to <code class="docutils literal"><span class="pre">nibabel/tests/data</span></code><a class="headerlink" href="#adding-the-file-to-nibabel-tests-data" title="Permalink to this headline">¶</a></h2>
<p>If the file is less then about 50K compressed, and the license is open, then
you might want to commit the file under <code class="docutils literal"><span class="pre">nibabel/tests/data</span></code>.</p>
<p>Put the license for any new files in the COPYING file at the top level of the
nibabel repo.  You&#8217;ll see some examples in that file already.</p>
</div>
<div class="section" id="adding-as-a-submodule-to-nibabel-data">
<h2>Adding as a submodule to <code class="docutils literal"><span class="pre">nibabel-data</span></code><a class="headerlink" href="#adding-as-a-submodule-to-nibabel-data" title="Permalink to this headline">¶</a></h2>
<p>Make a new git repository with the data.</p>
<p>There are example repos at</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/yarikoptic/nitest-balls1">https://github.com/yarikoptic/nitest-balls1</a></li>
<li><a class="reference external" href="https://github.com/matthew-brett/nitest-minc2">https://github.com/matthew-brett/nitest-minc2</a></li>
</ul>
<p>Despite the fact that both the examples are on github, <a class="reference external" href="https://bitbucket.org">Bitbucket</a> is good for
repos like this because they don&#8217;t enforce repository size limits.</p>
<p>Don&#8217;t forget to include a LICENSE and README file in the repo.</p>
<p>When all is done, and the repository is safely on the internet and accessible,
add the repo as a submodule to the <code class="docutils literal"><span class="pre">nitests-data</span></code> directory, with something
like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">submodule</span> <span class="n">add</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">bitbucket</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">nipy</span><span class="o">/</span><span class="n">rosetta</span><span class="o">-</span><span class="n">samples</span><span class="o">.</span><span class="n">git</span> <span class="n">nitests</span><span class="o">-</span><span class="n">data</span><span class="o">/</span><span class="n">rosetta</span><span class="o">-</span><span class="n">samples</span>
</pre></div>
</div>
<p>You should now have a checked out copy of the <code class="docutils literal"><span class="pre">rosetta-samples</span></code> repository
in the <code class="docutils literal"><span class="pre">nibabel-data/rosetta-samples</span></code> directory.  Commit the submodule that
is now in your git staging area.</p>
<p>If you are writing tests using files from this repository, you should use the
<code class="docutils literal"><span class="pre">needs_nibabel_data</span></code> decorator to skip the tests if the data has not been
checked out into the submodules.  See <code class="docutils literal"><span class="pre">nibabel/tests/test_parrec_data.py</span></code>
for an example.  For our example repository above it might look something
like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.nibabel_data</span> <span class="k">import</span> <span class="n">get_nibabel_data</span><span class="p">,</span> <span class="n">needs_nibabel_data</span>

<span class="n">ROSETTA_DATA</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">get_nibabel_data</span><span class="p">(),</span> <span class="s1">&#39;rosetta-samples&#39;</span><span class="p">)</span>

<span class="nd">@needs_nibabel_data</span><span class="p">(</span><span class="s1">&#39;rosetta-samples&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_something</span><span class="p">():</span>
    <span class="c1"># Some test using the data</span>
</pre></div>
</div>
<div class="section" id="using-submodules-for-tests">
<h3>Using submodules for tests<a class="headerlink" href="#using-submodules-for-tests" title="Permalink to this headline">¶</a></h3>
<p>Tests run via <a class="reference external" href="https://travis-ci.org/nipy/nibabel">nibabel on travis</a> start with an automatic checkout of all
submodules in the project, so all test data submodules get checked out by
default.</p>
<p>If you are running the tests locally, you may well want to do:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">submodule</span> <span class="n">update</span> <span class="o">--</span><span class="n">init</span>
</pre></div>
</div>
<p>from the root nibabel directory.  This will checkout all the test data
repositories.</p>
</div>
<div class="section" id="how-much-data-should-go-in-a-single-submodule">
<h3>How much data should go in a single submodule?<a class="headerlink" href="#how-much-data-should-go-in-a-single-submodule" title="Permalink to this headline">¶</a></h3>
<p>The limiting factor is how long it takes <a class="reference external" href="https://travis-ci.org">travis-ci</a> to checkout the data for
the tests.  Up to a hundred megabytes in one repository should be OK.  The joy
of submodules is we can always drop a submodule, split the repository into two
and add only one back, so you aren&#8217;t committing us to anything awful if you
accidentally put some very large files into your own data repository.</p>
</div>
<div class="section" id="if-in-doubt">
<h3>If in doubt<a class="headerlink" href="#if-in-doubt" title="Permalink to this headline">¶</a></h3>
<p>If you are not sure, try us with a pull request to <a class="reference external" href="https://github.com/nipy/nibabel">nibabel github</a>, or on the
<a class="reference external" href="https://mail.python.org/mailman/listinfo/neuroimaging">nipy mailing list</a>, we will try to help.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2006-2016, Matthew Brett, Michael Hanke, Eric Larson, Chris Markiewicz &lt;neuroimaging@python.org&gt;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.6.
    </div>
  </body>
</html>